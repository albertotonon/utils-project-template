# utils-project-template

This is a template for a GIT repository containing project experiments and shared code.
You can use the structure of this file as a template for the `README.md` file that should be placed at the root of your repo.

- **TODO**: insert here a short description of your project.
- **TODO**: look for `**TODO**` entries in all MarkDown files
- **TODO**: look for `# TODO` entries in all Python files
- **TODO**: substitute instances of `projectTemplate` with the name of your project.

Here are some useful pointers:
- [Project page](https://put_here_the_right_link.com) **TODO**
- [Technical reports](https://put_here_the_right_link.com), where the results of these experiments are usually reported if you don't write the report in their corresponding README.md file **TODO**
- [JIRA Epic](https://put_here_the_right_link.com) **TODO**

## Repository structure

This repository is structured as follows:
- Experiments/
- Scratches/ -- *git-ignored* --
- Libs/
- Data/ -- *git-ignored* --
- .envrc
- credentials_template.sh

The content of Data/ and Scratches/ is git-ignored. In this repo they only contain a README.md file.

**"Libs/"** contains "library" code that is shared across experiments. This is mostly Python code that is going to be edited in an IDE, unit-tested, linted, etc. It can include implementation/wrappers of classifiers or regressors, data cleaning procedures, evaluation methods etc. Basically everything you want to be able to reuse in your experiments.

**"Experiments/"** contains "experiment" code and experiment assets. Code can be in the form of python scripts, Jupyter notebooks, etc. Assets can be, for example, configurations files used to run the experiments. The structure of this folder is up to the engineer, it can be organised by experiment topic (e.g. "coverage" or "granularity"), by dataset (e.g. "Dump-20201008"), etc. **No dataset or sensitive information (e.g. passwords, credentials) is stored here** (see "Data/" and "credentials_template.sh")!

**"Scratches/"** is for running quick tests, for example, if you need a notebook for quickly computing how many cars you have in your dataset or try out a new feature analysis library you can do it here. This is stuff that can be trashed afterwards.

**"Data/"** contains the data generated by the experiments and the project datasets.

**".envrc"** is a file containing the global environment of your experiments as environment variable export statements. This is to be used with [direnv](https://direnv.net/). By using this you'll be able to use information on your environment when you run commands on remote servers, when you run your Python code and your notebook etc. See the readme of [this lib](Libs/lib0/README.md) and this [example notebook](Experiments/TestExperiment/00-first_notebook.ipynb) for more info.

**"credentials_template.sh"** is a file containing the list of environment variables associated to sensitive information needed to run the experiments in this repo. Notice that the file contains only the name of the variables, no value is assigned to them. Open [the file](credentials_template.sh) for more info.

### Utility modules

Libs/lib0 contains some utility method that you can use to import values of environment variables in notebooks and experiments to avoid having hardcoded paths. It contains methods for parsing data and converting data types, too.


### Folder rules
- Initially, the subfolders "Experiments/" and "Libs/" are versioned in **one** GIT repo, when "Libs/" become large and important it should be moved to another repo (or create a sub-repo);
- "Scratches/" and "Data/" are git-ignored;
- "Data/" is `rsync`-ed to volume storing the data. `rsync -vrh Data <remote_folder>`
- "Data/" has a directory structure similar to "Experiments/". If "Experiments/granularity/" exists then "Data/granularity/" exists as well. Notice that the other way is not mandatory, for example there can be "Data/Datasets/" without a corresponding "Experiments/Datasets/". See [this example notebook](Experiments/TestExperiment/00-first_notebook.ipynb) for a suggestion on how to keep the two folders in sync.

## Reusing code for experiments

To reuse "Libs/" code, the "Libs/" directory contains a `setup.py` Python file. It is then possible to `pip install -e` the code into other Python environments. For more info see [this readme file](Libs/README.md).

Mansplaining alert. When the `-e` option is used the code is installed in "**e**dit mode"; that means that as soon as something is modified in the lib's code, the installed library is modified as well (notebooks kernels must be restarted, alternatively, the modules can be reloaded).

## Operations

Here we describe the suggested steps one should do in some of the use cases associated to this repo.

### Testing out stuff
1. `cd` into "Scratches/"
2. Optional: create a new environment and `pip install -e` the library/ies in "Libs/" that you need. If there is an existing environment you can reuse, go for it;
3. Do all the mess you want;
4. If you want to convert anything useful into a "real experiment" see below.

### Starting a new experiment

1. Create a branch in the GIT repo with the experiment name;
2. Create a folder (or folder structure) in "Experiments/";
3. Create the same folder (or folder structure) in "Data/";
4. Feel free to include your experiment's environment in a `.envrc` file in your experiment directory, so that it's loaded by direnv;
5. Go! (and remember to commit/push to keep your code safe).

* Optional: the prefix of your folder name is the current date with format `%Y%m%d` (e.g. "20201019-Granularity")
* Optional: create a new Python venv in your new folder if it's significantly different from the environment associated to the whole experiment project.

### Experiment done

1. Make sure your Python environment is reproducible 
2. Commit, Push, Merge to master
3. Create a tag with the name of your experiment (e.g. "20201019-Granularity") so that you can restore the status of your GIT repo
4. `rsync` "Data/"

